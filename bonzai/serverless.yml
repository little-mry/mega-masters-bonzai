org: bonzaipj
service: bonzai

provider:
  name: aws
  runtime: nodejs20.x
  region: eu-north-1 # Stockholm
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:PutItem
        - dynamodb:GetItem
        - dynamodb:BatchGetItem 
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:DeleteItem
        - dynamodb:UpdateItem
        - dynamodb:TransactWriteItems
        - dynamodb:UpdateItem
        - dynamodb:DescribeTable
      Resource:
        - arn:aws:dynamodb:eu-north-1:*:table/bonzai-table
        - arn:aws:dynamodb:eu-north-1:*:table/bonzai-table/index/*

build:
  esbuild:
    minify: true

package:
  individually: true

functions:
  getRooms:
    handler: functions/getRooms/index.handler
    events:
      - httpApi:
          path: /rooms
          method: get

  postRooms:
    handler: functions/postRooms/index.handler
    events:
      - httpApi:
          path: /rooms
          method: post

  createBooking:
    handler: functions/createBooking/index.handler
    events:
      - httpApi:
          path: /bookings
          method: post

  getBookings:
    handler: functions/getBookings/index.handler
    events:
      - httpApi:
          path: /bookings
          method: get

  updateBooking:
    handler: functions/updateBooking/index.handler
    events:
      - httpApi:
          path: /bookings/{id}
          method: put

  cancelBooking:
    handler: functions/cancelBooking/index.handler
    events:
      - httpApi:
          path: /bookings/{id}
          method: delete